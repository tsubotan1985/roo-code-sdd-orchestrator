# Rule: Task Execution & Implementation Plan Protocol (Enhanced v2)

## Part A: Task Execution (For `task-executor` mode)

`tasks.md`から単一タスクを実行する際は、以下の手順を厳守してください。

1.  **Context Gathering:** `tasks.md`のタスク内容、リンクされた`requirements.md`の要件、`design.md`の関連設計を読み込み、タスクの目的と技術的背景を完全に理解します。
2.  **TDD (Test-Driven Development):** まず、要件を満たすための失敗するテストケースを作成します。
3.  **Implementation:** テストをパスするための最小限のコードを実装します。
4.  **Verification:** すべてのテストがパスし、リンターのエラーがないことを確認します。
5.  **Commit:** Conventional Commits形式（例: `feat(task-3.1): Implement pixel mask application`）で変更をコミットします。

## Part B: Implementation Plan Creation (For `spec-architect` mode)

`design.md`から`tasks.md`を生成する際は、以下の**高精度品質基準**を満たしてください。

### 1. タスク構造化の原則

#### 1.1 階層化されたタスク構造
- **メインタスク**: 機能単位での大きなタスク（例: "1. コア円形回帰コンポーネントの作成"）
- **サブタスク**: 具体的な実装単位（例: "AngleEncoderクラスのsin/cos変換メソッドを実装"）
- **要件トレーサビリティ**: 各タスクまたはタスクグループの末尾に`_要件: 1.4, 1.5, 6.1_`形式で対応要件IDを記載

#### 1.2 タスク記述の詳細度
- **具体的なクラス名・メソッド名**: 実装対象を明確に特定
- **技術的詳細**: 使用する技術やアルゴリズムを明記
- **成果物の明確化**: 何が完成するかを具体的に記述

### 2. 品質基準

#### 2.1 粒度 (Granularity)
- 各サブタスクは単一のコミットで完了できる程度に細分化
- 1つのタスクは1つの責務のみを持つ
- 例: ❌「データ処理機能を実装」→ ⭕「DataProcessorクラスを実装」「入力検証メソッドを追加」

#### 2.2 順序性 (Sequencing)
- 依存関係を考慮した論理的な順序
- 基盤となるコンポーネントから上位レイヤーへの順序
- テストとドキュメントは実装と並行または直後に配置

#### 2.3 包括性 (Comprehensiveness)
以下の要素を必ず含める：
- **コア実装**: 主要な機能実装
- **テスト作成**: 単体テスト、統合テスト、パフォーマンステスト
- **エラーハンドリング**: 例外処理と検証ロジック
- **ドキュメント更新**: API仕様、ユーザーガイド、トラブルシューティング
- **統合作業**: 既存システムとの統合
- **検証・監視**: パフォーマンス監視、ログ記録

#### 2.4 日本語化要件
- **タスクタイトル**: 日本語で記述
- **サブタスク**: 日本語で記述
- **要件参照**: 日本語形式（`_要件: 1.4, 1.5, 6.1_`）

### 3. タスクリスト生成テンプレート

```markdown
# 実装計画

- [ ] 1. [メイン機能名]
  - [具体的なクラス・メソッド実装]
  - [テスト作成]
  - [ドキュメント更新]
  - _要件: [要件ID]_

- [ ] 2. [次のメイン機能名]
  - [詳細なサブタスク1]
  - [詳細なサブタスク2]
  - [統合・検証作業]
  - _要件: [要件ID]_
```

### 4. 品質チェックリスト

実装計画作成時に以下を確認：
- [ ] 各タスクに具体的なクラス名・メソッド名が含まれているか
- [ ] サブタスクが適切に階層化されているか
- [ ] 要件トレーサビリティが全タスクに記載されているか
- [ ] テスト・ドキュメント・エラーハンドリングが含まれているか
- [ ] タスクが日本語で記述されているか
- [ ] 依存関係を考慮した順序になっているか
